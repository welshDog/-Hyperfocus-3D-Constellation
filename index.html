<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyperfocus Constellation - 3D Repository Galaxy</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <!-- 3D Canvas Container -->
    <div id="galaxy-container">
        <canvas id="galaxy-canvas"></canvas>
    </div>

    <!-- Main UI Overlay -->
    <div id="ui-overlay">
        <!-- Top Navigation Bar -->
        <nav class="nav-bar glass-panel">
            <div class="nav-content">
                <h1 class="constellation-title">
                    <span class="title-icon">‚ú®</span>
                    Hyperfocus Constellation (68 Repos)
                </h1>
                
                <!-- Search -->
                <div class="search-container">
                    <input type="text" id="search-input" class="search-input" placeholder="üîç Search repositories..." autocomplete="off">
                    <button id="voice-search-btn" class="voice-btn" title="Voice Search">üé§</button>
                </div>

                <!-- Performance Metrics -->
                <div class="performance-display">
                    <span id="fps-counter">FPS: --</span>
                    <span id="render-time">Render: --ms</span>
                    <span id="repo-count">Repos: 0</span>
                </div>
            </div>
        </nav>

        <!-- Category Filter Panel -->
        <div class="filter-panel glass-panel">
            <h3>Language Filters</h3>
            <div class="category-filters" id="languageFilters">
                <button class="filter-btn active" data-language="all">
                    <span class="filter-icon">üåü</span>
                    All
                </button>
            </div>
        </div>

        <!-- Accessibility Controls -->
        <div class="accessibility-panel glass-panel">
            <h3>Accessibility</h3>
            <div class="control-grid">
                <label class="control-item">
                    <input type="checkbox" id="motion-reduction">
                    <span class="control-label">üêå Reduce Motion</span>
                </label>
                <label class="control-item">
                    <input type="checkbox" id="focus-mode">
                    <span class="control-label">üéØ Focus Mode</span>
                </label>
                <label class="control-item">
                    <input type="checkbox" id="audio-enabled">
                    <span class="control-label">üîä Audio</span>
                </label>
                <label class="control-item">
                    <input type="checkbox" id="high-contrast">
                    <span class="control-label">üåì Contrast</span>
                </label>
            </div>
        </div>

        <!-- Repository Info Panel -->
        <div id="repo-info-panel" class="info-panel glass-panel hidden">
            <div class="info-header">
                <h2 id="repo-name"></h2>
                <button id="close-info" class="close-btn">‚úï</button>
            </div>
            <div class="info-content">
                <div class="repo-stats">
                    <span id="repo-language" class="language-tag"></span>
                    <span id="repo-stars" class="stars-count">‚≠ê 0</span>
                    <span id="repo-issues" class="issues-count">üêõ 0</span>
                </div>
                <p id="repo-description"></p>
                <div class="repo-meta">
                    <span id="repo-updated"></span>
                    <span id="repo-status" class="status"></span>
                </div>
                <div class="repo-actions">
                    <a id="repo-github-link" href="#" target="_blank" class="btn btn--primary">
                        <span>üîó View on GitHub</span>
                    </a>
                    <button id="bookmark-btn" class="btn btn--secondary">
                        <span id="bookmark-icon">üîñ</span> Bookmark
                    </button>
                </div>
            </div>
        </div>

        <!-- Mini-map -->
        <div class="minimap glass-panel">
            <h4>Galaxy Map</h4>
            <canvas id="minimap-canvas" width="150" height="150"></canvas>
        </div>

        <!-- Tour & Help Controls -->
        <div class="tour-controls glass-panel">
            <button id="reset-view" class="btn btn--outline">
                üè† Reset Camera
            </button>
        </div>

        <!-- Bookmarks Panel -->
        <div id="bookmarks-panel" class="bookmarks-panel glass-panel hidden">
            <div class="bookmarks-header">
                <h3>üîñ Bookmarks</h3>
                <button id="toggle-bookmarks" class="toggle-btn">‚úï</button>
            </div>
            <div id="bookmarks-list" class="bookmarks-list">
                <!-- Dynamic bookmark items -->
            </div>
        </div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner">
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
                <div class="spinner-ring"></div>
            </div>
            <h2>Initializing Constellation...</h2>
            <p id="loading-status">Fetching your 68 repositories from GitHub</p>
            <div class="loading-progress">
                <div id="loading-bar" class="progress-bar"></div>
            </div>
        </div>
    </div>

    <script>
        // GitHub API Client
        class GitHubAPI {
            static async fetchAllRepos(username) {
                const repos = [];
                let page = 1;
                let hasMore = true;

                while (hasMore) {
                    try {
                        const response = await fetch(
                            `https://api.github.com/users/${username}/repos?page=${page}&per_page=100&sort=updated&direction=desc`
                        );
                        const data = await response.json();

                        if (data.length === 0) {
                            hasMore = false;
                        } else {
                            repos.push(...data);
                            page++;
                            document.getElementById('loading-status').textContent = `Loaded ${repos.length} repositories...`;
                        }
                    } catch (error) {
                        console.error('GitHub API error:', error);
                        hasMore = false;
                    }
                }

                return repos;
            }
        }

        // Main App State
        const appState = {
            repos: [],
            particles: [],
            selectedRepo: null,
            filteredRepos: [],
            languages: new Set(),
            bookmarks: JSON.parse(localStorage.getItem('bookmarks') || '[]'),
        };

        // Initialize App
        async function init() {
            try {
                // Fetch all repos
                const repos = await GitHubAPI.fetchAllRepos('welshDog');
                appState.repos = repos;
                
                // Extract languages
                repos.forEach(repo => {
                    if (repo.language) appState.languages.add(repo.language);
                });

                // Create filter buttons
                const filterContainer = document.getElementById('languageFilters');
                Array.from(appState.languages).sort().forEach(lang => {
                    const btn = document.createElement('button');
                    btn.className = 'filter-btn';
                    btn.dataset.language = lang;
                    btn.textContent = `${lang} (${repos.filter(r => r.language === lang).length})`;
                    btn.addEventListener('click', () => filterByLanguage(lang));
                    filterContainer.appendChild(btn);
                });

                // Hide loading screen
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('repo-count').textContent = `Repos: ${repos.length}`;

                // Start visualization
                initVisualization(repos);

            } catch (error) {
                console.error('Init error:', error);
                document.getElementById('loading-status').textContent = '‚ùå Error loading repositories';
            }
        }

        function filterByLanguage(language) {
            if (language === 'all') {
                appState.filteredRepos = appState.repos;
            } else {
                appState.filteredRepos = appState.repos.filter(r => r.language === language);
            }
            console.log(`Filtered to ${appState.filteredRepos.length} ${language} repositories`);
        }

        function initVisualization(repos) {
            // This would integrate with your Three.js or canvas setup
            // For now, setup interactive elements
            document.getElementById('reset-view').addEventListener('click', resetView);
            document.getElementById('close-info').addEventListener('click', closeInfo);
            document.getElementById('toggle-bookmarks').addEventListener('click', toggleBookmarks);
            document.getElementById('bookmark-btn').addEventListener('click', toggleBookmark);
            
            // Search functionality
            document.getElementById('search-input').addEventListener('input', handleSearch);
        }

        function resetView() {
            console.log('Resetting view...');
            // Reset Three.js camera if implemented
        }

        function closeInfo() {
            document.getElementById('repo-info-panel').classList.add('hidden');
            appState.selectedRepo = null;
        }

        function toggleBookmarks() {
            const panel = document.getElementById('bookmarks-panel');
            panel.classList.toggle('hidden');
        }

        function toggleBookmark() {
            if (!appState.selectedRepo) return;
            const idx = appState.bookmarks.findIndex(b => b.id === appState.selectedRepo.id);
            if (idx > -1) {
                appState.bookmarks.splice(idx, 1);
                document.getElementById('bookmark-icon').textContent = 'üîñ';
            } else {
                appState.bookmarks.push(appState.selectedRepo);
                document.getElementById('bookmark-icon').textContent = '‚úÖ';
            }
            localStorage.setItem('bookmarks', JSON.stringify(appState.bookmarks));
        }

        function handleSearch(e) {
            const query = e.target.value.toLowerCase();
            const filtered = appState.repos.filter(r => 
                r.name.toLowerCase().includes(query) ||
                (r.description && r.description.toLowerCase().includes(query))
            );
            console.log(`Found ${filtered.length} matching repositories`);
        }

        // Start
        init();
    </script>
    <script src="app.js"></script>
</body>
</html>